{% load static %}
<section class="profile-section" id="edit-profile" aria-labelledby="profile-details-heading">
  <div class="profile-card">
    {% if can_edit %}
      <form id="edit-profile-form" class="profile-form" method="post" action="" enctype="multipart/form-data" novalidate>
        {% csrf_token %}
        {% if form.non_field_errors %}
        <div class="alert alert-danger" role="alert">
          {% for error in form.non_field_errors %}
            <div>{{ error }}</div>
          {% endfor %}
        </div>
        {% endif %}
        <fieldset>
          <legend id="profile-details-heading" class="profile-section-title">Profile details</legend>
          <div class="profile-form-intro">
            <p class="text-muted small mb-0">Keep your contact information current so we can reach you when support teams need to follow up.</p>
          </div>
          {% include "partials/avatar_upload.html" %}
          <div class="form-grid" role="group" aria-labelledby="profile-details-heading">
            <div class="form-field">
              <label class="form-label" for="{{ form.full_name.id_for_label }}">Full name</label>
              {{ form.full_name }}
              {% if form.full_name.errors %}
              <div class="invalid-feedback d-block">
                {% for error in form.full_name.errors %}
                  <div>{{ error }}</div>
                {% endfor %}
              </div>
              {% endif %}
            </div>
            <div class="form-field">
              <label class="form-label" for="{{ form.email.id_for_label }}">Email</label>
              {{ form.email }}
              {% if form.email.errors %}
              <div class="invalid-feedback d-block">
                {% for error in form.email.errors %}
                  <div>{{ error }}</div>
                {% endfor %}
              </div>
              {% endif %}
            </div>
            <div class="form-field">
              <label class="form-label" for="{{ form.phone.id_for_label }}">Phone</label>
              {{ form.phone }}
              {% if form.phone.errors %}
              <div class="invalid-feedback d-block">
                {% for error in form.phone.errors %}
                  <div>{{ error }}</div>
                {% endfor %}
              </div>
              {% endif %}
            </div>
            <div class="form-field">
              <label class="form-label" for="{{ form.location.id_for_label }}">Location</label>
              {{ form.location }}
              {% if form.location.errors %}
              <div class="invalid-feedback d-block">
                {% for error in form.location.errors %}
                  <div>{{ error }}</div>
                {% endfor %}
              </div>
              {% endif %}
            </div>
            <div class="form-field">
              <label class="form-label" for="{{ form.timezone.id_for_label }}">Timezone</label>
              {{ form.timezone }}
              {% if form.timezone.errors %}
              <div class="invalid-feedback d-block">
                {% for error in form.timezone.errors %}
                  <div>{{ error }}</div>
                {% endfor %}
              </div>
              {% endif %}
            </div>
          </div>
          <div class="form-field">
            <label class="form-label" for="{{ form.bio.id_for_label }}">Bio</label>
            {{ form.bio }}
            <div id="bio-hint" class="form-text">Share any information that helps our team support you. Avoid including sensitive data.</div>
            {% if form.bio.errors %}
            <div class="invalid-feedback d-block">
              {% for error in form.bio.errors %}
                <div>{{ error }}</div>
              {% endfor %}
            </div>
            {% endif %}
          </div>
        </fieldset>
        <div class="form-actions">
          <button type="submit" class="btn btn-primary">Save changes</button>
          <button type="reset" class="btn btn-outline-secondary">Reset</button>
        </div>
      </form>
    {% else %}
      <div class="profile-summary" aria-live="polite">
        <h2 id="profile-details-heading" class="profile-section-title">Profile details</h2>
        <div class="profile-summary-grid">
          <dl>
            <dt>Full name</dt>
            <dd>{{ profile.full_name|default:user.get_full_name|default:user.username }}</dd>
          </dl>
          <dl>
            <dt>Email</dt>
            <dd><a href="mailto:{{ profile.email|default:user.email }}">{{ profile.email|default:user.email }}</a></dd>
          </dl>
          <dl>
            <dt>Phone</dt>
            <dd>{% if profile.phone %}<a href="tel:{{ profile.phone }}">{{ profile.phone }}</a>{% else %}<span class="text-muted">Not provided</span>{% endif %}</dd>
          </dl>
          <dl>
            <dt>Location</dt>
            <dd>{{ profile.location|default:'Not specified' }}</dd>
          </dl>
          <dl>
            <dt>Timezone</dt>
            <dd>{{ profile.timezone|default:'Not specified' }}</dd>
          </dl>
        </div>
        <div class="profile-summary-bio">
          <h3 class="h6">About</h3>
          <p>{{ profile.bio|default:'No bio available yet.' }}</p>
        </div>
      </div>
    {% endif %}
  </div>
</section>